From 35744f99edafcbdd307f2dc2539ca6b46b058fd0 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Sun, 17 May 2020 22:33:42 +0300
Subject: [PATCH 1/5] cl-som-imx7: Add u-boot.imx target

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 Makefile | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 1428a7d..877e548 100644
--- a/Makefile
+++ b/Makefile
@@ -802,7 +802,7 @@ DO_STATIC_RELA =
 endif
 
 # Always append ALL so that arch config.mk's can add custom ones
-ALL-y += u-boot.srec u-boot.bin u-boot.sym System.map binary_size_check
+ALL-y += u-boot.srec u-boot.bin u-boot.sym System.map binary_size_check u-boot.imx
 
 ALL-$(CONFIG_ONENAND_U_BOOT) += u-boot-onenand.bin
 ifeq ($(CONFIG_SPL_FSL_PBL),y)
@@ -1134,6 +1134,10 @@ else
 SPL_PAYLOAD := u-boot.bin
 endif
 
+u-boot.imx: SPL u-boot.img u-boot-ivt.img FORCE
+	@dd if=SPL of=$@ bs=1K seek=0 conv=notrunc 2>/dev/null
+	@dd if=u-boot.img of=$@ bs=1K seek=63 conv=notrunc 2>/dev/null
+
 OBJCOPYFLAGS_u-boot-with-spl.bin = -I binary -O binary \
 				   --pad-to=$(CONFIG_SPL_PAD_TO)
 u-boot-with-spl.bin: spl/u-boot-spl.bin $(SPL_PAYLOAD) FORCE
-- 
1.9.1

