#!/bin/bash

files="SPL u-boot-ivt.img"
O=signed/u
u=u-boot.imx.signed

install -d ${O}

for f in ${files};do
(cat ../bin/csf.in ; awk -v file=${f} -F"HAB Blocks:" '(/HAB Blocks:/)&&($2=$2)&&($0="Blocks = "$2" \""file"\"")' ${f}.log) > ${O}/${f}.in
../linux64/bin/cst --o ${O}/csf-${f}.bin --i ${O}/${f}.in
cat ${f} ${O}/csf-${f}.bin > ${O}/${f}.signed
done

dd if=${O}/SPL.signed of=${O}/${u} bs=1K seek=0
dd if=${O}/u-boot-ivt.img.signed of=${O}/${u} bs=1K seek=63 conv=notrunc
